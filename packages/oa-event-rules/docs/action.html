<!DOCTYPE html>

<html>
<head>
  <title>action.coffee</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page_wrapper">
            <div id="jump_page">
              
                
                <a class="source" href="action.html">
                  action.coffee
                </a>
              
                
                <a class="source" href="agent.html">
                  agent.coffee
                </a>
              
                
                <a class="source" href="agent_generic.html">
                  agent_generic.coffee
                </a>
              
                
                <a class="source" href="agent_graylog.html">
                  agent_graylog.coffee
                </a>
              
                
                <a class="source" href="agent_http.html">
                  agent_http.coffee
                </a>
              
                
                <a class="source" href="agent_syslogd.html">
                  agent_syslogd.coffee
                </a>
              
                
                <a class="source" href="agents.html">
                  agents.coffee
                </a>
              
                
                <a class="source" href="agentsyslog.html">
                  agentsyslog.coffee
                </a>
              
                
                <a class="source" href="day_time.html">
                  day_time.coffee
                </a>
              
                
                <a class="source" href="dedupe.html">
                  dedupe.coffee
                </a>
              
                
                <a class="source" href="discard.html">
                  discard.coffee
                </a>
              
                
                <a class="source" href="event.html">
                  event.coffee
                </a>
              
                
                <a class="source" href="event_rules.html">
                  event_rules.coffee
                </a>
              
                
                <a class="source" href="group.html">
                  group.coffee
                </a>
              
                
                <a class="source" href="groups.html">
                  groups.coffee
                </a>
              
                
                <a class="source" href="index.html">
                  index.coffee
                </a>
              
                
                <a class="source" href="levels.html">
                  levels.coffee
                </a>
              
                
                <a class="source" href="option.html">
                  option.coffee
                </a>
              
                
                <a class="source" href="rule.html">
                  rule.coffee
                </a>
              
                
                <a class="source" href="rule_set.html">
                  rule_set.coffee
                </a>
              
                
                <a class="source" href="schedule.html">
                  schedule.coffee
                </a>
              
                
                <a class="source" href="schedules.html">
                  schedules.coffee
                </a>
              
                
                <a class="source" href="select.html">
                  select.coffee
                </a>
              
                
                <a class="source" href="select_all.html">
                  select_all.coffee
                </a>
              
                
                <a class="source" href="select_base.html">
                  select_base.coffee
                </a>
              
                
                <a class="source" href="select_ends_with.html">
                  select_ends_with.coffee
                </a>
              
                
                <a class="source" href="select_equals.html">
                  select_equals.coffee
                </a>
              
                
                <a class="source" href="select_field_exists.html">
                  select_field_exists.coffee
                </a>
              
                
                <a class="source" href="select_field_missing.html">
                  select_field_missing.coffee
                </a>
              
                
                <a class="source" href="select_greater_than.html">
                  select_greater_than.coffee
                </a>
              
                
                <a class="source" href="select_less_than.html">
                  select_less_than.coffee
                </a>
              
                
                <a class="source" href="select_match.html">
                  select_match.coffee
                </a>
              
                
                <a class="source" href="select_none.html">
                  select_none.coffee
                </a>
              
                
                <a class="source" href="select_schedule.html">
                  select_schedule.coffee
                </a>
              
                
                <a class="source" href="select_starts_with.html">
                  select_starts_with.coffee
                </a>
              
                
                <a class="source" href="transforms.html">
                  transforms.coffee
                </a>
              
            </div>
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>action.coffee</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>logging</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>{ logger, debug } = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;oa-logging&#x27;</span>)(<span class="hljs-string">&#x27;oa:event:rules:action&#x27;</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>npm modules</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>yaml  = <span class="hljs-built_in">require</span> <span class="hljs-string">&#x27;js-yaml&#x27;</span></pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>oa modules</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>{ _
  is_regexy
  regexy_to_regex
  throw_error
  format_string  } = <span class="hljs-built_in">require</span> <span class="hljs-string">&#x27;oa-helpers&#x27;</span>

Errors = <span class="hljs-built_in">require</span> <span class="hljs-string">&#x27;oa-errors&#x27;</span></pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>We need self as we are building the classes on this (<code>@</code>) for export
If we reference need to reference the classes anywhere @ changes
probably should go back to module.exports to be less esoteric</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>self = <span class="hljs-built_in">this</span></pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <h2 id="class-actionbase">Class ActionBase</h2>
<p>The base Action implementation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="hljs-class"><span class="hljs-keyword">class</span> @<span class="hljs-title">ActionBase</span></span>

  @label: <span class="hljs-string">&#x27;__base&#x27;</span></pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>Provides a description of the Actions fields</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  @description: <span class="hljs-function">-&gt;</span> {
    name: @label
    input: []
  }

  @generate: <span class="hljs-function"><span class="hljs-params">(yaml_def)</span> -&gt;</span>
    <span class="hljs-keyword">unless</span> yaml_def[@label]?
      Errors.throw_a Errors.ValidationError, <span class="hljs-string">&quot;No [<span class="hljs-subst">#{@label}</span>] field in definition&quot;</span>, yaml_def
    <span class="hljs-keyword">new</span> @</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>The action_id must be a truthey value</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  constructor: <span class="hljs-function"><span class="hljs-params">(@action_id = <span class="hljs-literal">true</span>)</span> -&gt;</span>
    @label = @constructor.label

  run: <span class="hljs-function"><span class="hljs-params">(event_obj)</span> -&gt;</span>
    throw_error <span class="hljs-string">&#x27;run not implemented&#x27;</span>

  toString: <span class="hljs-function">-&gt;</span>
    <span class="hljs-string">&quot;@::constructor.label&quot;</span>

  to_yaml_obj: <span class="hljs-function">-&gt;</span>
    throw_error <span class="hljs-string">&#x27;to_yaml_obj not implemented&#x27;</span>

  to_yaml: <span class="hljs-function">-&gt;</span>
    yaml.dump @to_yaml_obj()</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <h6 id="format_string-event-value--value-">format_string( event, value = @value )</h6>

            </div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>Field <code>{field}</code> and re match group <code>{match.1}</code> replacement</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  @match_group_re = <span class="hljs-regexp">/\{match\.\d+\}/</span>
  @input_re = <span class="hljs-regexp">/\{input\.[\w\.]+}/</span></pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>@format_string_re: /{match.\d+}/</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  replace_format_string: <span class="hljs-function"><span class="hljs-params">( event, value = @value )</span>-&gt;</span>
    <span class="hljs-keyword">unless</span> _.isString value
      <span class="hljs-keyword">return</span> value</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>first replace the {values} with anything from the modified event</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    value = format_string @value, event.copy</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>Check if the have a {input.structuredData} group in the message</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> value.match( <span class="hljs-regexp">/\{input\.structuredData\.[\w\._]+}/</span> )
      <span class="hljs-keyword">if</span> event.has_structured_data()
        debug <span class="hljs-string">&#x27;found a {input.structuredData} value to replace&#x27;</span>, value, event.input.structuredData
        value = ActionBase.format_string_with_prefix <span class="hljs-string">&#x27;input.structuredData&#x27;</span>, @value, event.input.structuredData
      <span class="hljs-keyword">else</span>
        logger.warn <span class="hljs-string">&#x27;Rule was looking for structured data but none was available&#x27;</span></pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>Check if the have a {input.} group in the message</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> value.match( <span class="hljs-regexp">/\{input\.[\w\._]+}/</span> )
      debug <span class="hljs-string">&#x27;found a {input.} value to replace&#x27;</span>, value, event.input
      value = ActionBase.format_string_with_prefix <span class="hljs-string">&#x27;input&#x27;</span>, @value, event.input</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>Check if the have a {match.1} group still in the message</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">unless</span> value.match( <span class="hljs-regexp">/\{match\.\d+\}/</span> )
      <span class="hljs-keyword">return</span> value

    match_arr = event.match_groups()
    <span class="hljs-keyword">unless</span> match_arr.length &gt; <span class="hljs-number">0</span>
      debug <span class="hljs-string">&quot;format_string: event didn&#x27;t have match groups&quot;</span>, match_arr
      logger.warn <span class="hljs-string">&quot;A rule tried to replace match groups but the supplied event didn&#x27;t have any&quot;</span>, event, value
      <span class="hljs-keyword">return</span> value

    debug <span class="hljs-string">&quot;format_string: doing a match replace with match_arr&quot;</span>, match_arr
    match_format_vars = {}
    <span class="hljs-keyword">for</span> matched, i <span class="hljs-keyword">in</span> match_arr
      match_format_vars[<span class="hljs-string">&quot;match.<span class="hljs-subst">#{i+<span class="hljs-number">1</span>}</span>&quot;</span>] = matched

    debug <span class="hljs-string">&quot;format_string: doing a match replace @val[%s] val[%s] vars[%j]&quot;</span>, @value, value, match_format_vars
    
    value = format_string value, match_format_vars</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>Replace only {prefix.field} values with data.
For log4j2/RFC5424 syslog.implementation.
Does not recurse down objects!
I did this quickly, It needs a generic solution for . notation replacements
like <code>format_string</code> in <code>oa-helpers</code> where most of this is yanked from</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  @format_string_with_prefix: <span class="hljs-function"><span class="hljs-params">( prefix, str, args... )</span>-&gt;</span>
    debug <span class="hljs-string">&#x27;format_string_with_prefix in&#x27;</span>, prefix, str, args</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>leave if there’s something odd</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">return</span> str <span class="hljs-keyword">if</span> <span class="hljs-keyword">typeof</span> str <span class="hljs-keyword">isnt</span> <span class="hljs-string">&#x27;string&#x27;</span></pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>leave unless we have data</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">return</span> str <span class="hljs-keyword">unless</span> args</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>leave unless we have something to replace <code>{blah}</code>
which is a bit quicker than failing to match every arg</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">return</span> str <span class="hljs-keyword">unless</span> str.indexOf(<span class="hljs-string">&#x27;{&#x27;</span>) &gt; <span class="hljs-number">-1</span> <span class="hljs-keyword">and</span> str.indexOf(<span class="hljs-string">&#x27;}&#x27;</span>) &gt; <span class="hljs-number">-1</span>

    args = args[<span class="hljs-number">0</span>] <span class="hljs-keyword">if</span> <span class="hljs-keyword">typeof</span> args[<span class="hljs-number">0</span>] <span class="hljs-keyword">is</span> <span class="hljs-string">&#x27;object&#x27;</span>
    <span class="hljs-keyword">for</span> arg <span class="hljs-keyword">of</span> args
      debug <span class="hljs-string">&#x27;format_string_with_prefix arg&#x27;</span>, arg, prefix, str
      re  = <span class="hljs-built_in">RegExp</span> <span class="hljs-string">&quot;\\{<span class="hljs-subst">#{prefix}</span>\.<span class="hljs-subst">#{arg}</span>\\}&quot;</span>, <span class="hljs-string">&quot;gi&quot;</span>
      str = str.replace re, args[arg]
    <span class="hljs-keyword">return</span> str</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <h3 id="actionset">ActionSet</h3>

            </div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>Set an event field to a value
Supports a {field} notation to reference fields from the event
Supports a {match.n} notation to reference captured groups from 
Select Match</p>

            </div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>Plain values</p>

            </div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>   set:
     afield: value</p>

            </div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>Multiple values</p>

            </div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>   set:
     afield: value
     bfield: value</p>

            </div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>Use entities from the event object</p>

            </div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>   set:
     afield: “Use the value from {another_event_field}”</p>

            </div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>Use capture groups from the Select Match</p>

            </div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>   set:
     afield: “Use the capture group from select &gt; {match.1}”</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="hljs-class"><span class="hljs-keyword">class</span> @<span class="hljs-title">ActionSet</span> <span class="hljs-keyword">extends</span> @<span class="hljs-title">ActionBase</span></span>

  @label: <span class="hljs-string">&#x27;set&#x27;</span>

  @description: <span class="hljs-function">-&gt;</span> {
    name: @label
    description: <span class="hljs-string">&#x27;Sets the value of a field to a specified value.&#x27;</span>
    input: [{
      name: <span class="hljs-string">&#x27;field&#x27;</span>
      label: <span class="hljs-string">&#x27;field&#x27;</span>
      type: <span class="hljs-string">&#x27;string&#x27;</span>
    },
    {
      name: <span class="hljs-string">&#x27;value&#x27;</span>
      label: <span class="hljs-string">&#x27;value&#x27;</span>
      type: <span class="hljs-string">&#x27;string&#x27;</span>
      beforetext: <span class="hljs-string">&#x27;to&#x27;</span>
    }]
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p>Generate a set</p>

            </div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <pre><code>set:
  a_field: new_view</code></pre>

            </div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <pre><code>set:
  a_field: new_valuesys
  both_field: other value</code></pre>

            </div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>Returns an array of set objects</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
  @generate: <span class="hljs-function"><span class="hljs-params">(yaml_def)</span> -&gt;</span>
    Errors.throw_a Errors.ValidationError, <span class="hljs-string">&quot;no [<span class="hljs-subst">#{@label}</span>] in definition&quot;</span>, yaml_def <span class="hljs-keyword">unless</span> yaml_def[@label]?
    
    sets = <span class="hljs-keyword">for</span> field, value <span class="hljs-keyword">of</span> yaml_def[@label]
      Errors.throw_a Errors.ValidationError, <span class="hljs-string">&quot;no [<span class="hljs-subst">#{@label}</span>] value in definition&quot;</span>, yaml_def <span class="hljs-keyword">unless</span> value?
      <span class="hljs-keyword">new</span> @ field, value


  constructor: <span class="hljs-function"><span class="hljs-params">(@field, @value)</span> -&gt;</span></pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p>Check for emptiness of field and value</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    throw_error <span class="hljs-string">&#x27;Action param 1: field&#x27;</span> <span class="hljs-keyword">unless</span> @field?
    throw_error <span class="hljs-string">&#x27;Action param 2: value&#x27;</span> <span class="hljs-keyword">unless</span> @value?
    throw_error <span class="hljs-string">&#x27;Action param 1: field&#x27;</span> <span class="hljs-keyword">if</span> @field == <span class="hljs-string">&#x27;&#x27;</span>
    throw_error <span class="hljs-string">&#x27;Action param 2: value&#x27;</span> <span class="hljs-keyword">if</span> @value == <span class="hljs-string">&#x27;&#x27;</span>
    debug <span class="hljs-string">&#x27;new&#x27;</span>, @label, @field, @value
    @label = @constructor.label</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>store the {match.n} regexp
@match_re: /{match.\d+}/g</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
  run: <span class="hljs-function"><span class="hljs-params">(event_obj)</span> -&gt;</span>
    debug <span class="hljs-string">&quot;run about to set field [%s] to [%s]&quot;</span>, @field, @value
    value = @value</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p>magical field and match group replacement</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    value = @replace_format_string event_obj

    event_obj.set @field, value
    debug <span class="hljs-string">&quot;set field [%s] to [%s]&quot;</span>, @field, value
    event_obj


  toString: <span class="hljs-function">-&gt;</span>
    <span class="hljs-string">&quot;set [<span class="hljs-subst">#{@field}</span>] to [<span class="hljs-subst">#{@value}</span>]&quot;</span>


  to_yaml_obj: <span class="hljs-function">-&gt;</span>
    action_obj = {}
    action_obj[@field] = @value
    action_obj</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <h3 id="actiondiscard">ActionDiscard</h3>

            </div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <p>   discard: true</p>

            </div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p>Discard this event, and stop rule processing</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="hljs-class"><span class="hljs-keyword">class</span> @<span class="hljs-title">ActionDiscard</span> <span class="hljs-keyword">extends</span> @<span class="hljs-title">ActionBase</span></span>
  
  @label: <span class="hljs-string">&#x27;discard&#x27;</span>

  @description: <span class="hljs-function">-&gt;</span> {
    name: @label
    description: <span class="hljs-string">&#x27;Discards the event immediately, and applies no further processing.&#x27;</span>
    friendly_name: <span class="hljs-string">&#x27;Discard&#x27;</span>
    friendly_after: <span class="hljs-string">&#x27;this event&#x27;</span>
    input: []
  }

  run: <span class="hljs-function"><span class="hljs-params">(event_obj)</span> -&gt;</span>
    debug <span class="hljs-string">&#x27;discarding event&#x27;</span>, @action_id
    event_obj.set <span class="hljs-string">&#x27;severity&#x27;</span>, <span class="hljs-number">-1</span>
    event_obj.discard @action_id
    event_obj.stop @action_id
    event_obj

  to_yaml_obj: <span class="hljs-function">-&gt;</span>
    action_obj = {}
    action_obj[@constructor.label] = <span class="hljs-literal">true</span>
    action_obj</pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <h3 id="actionreplace">ActionReplace</h3>

            </div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <p>   replace:
     field: name
     this:  /what to look for/
     with:  whatever</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="hljs-class"><span class="hljs-keyword">class</span> @<span class="hljs-title">ActionReplace</span> <span class="hljs-keyword">extends</span> @<span class="hljs-title">ActionBase</span></span>
  
  @label: <span class="hljs-string">&#x27;replace&#x27;</span>

  @description: <span class="hljs-function">-&gt;</span> {
    name: @label
    description: <span class="hljs-string">&#x27;Replaces content within a field. Regex is allowed.&#x27;</span>
    input: [{
      name: <span class="hljs-string">&#x27;field&#x27;</span>
      label: <span class="hljs-string">&#x27;field&#x27;</span>
      type: <span class="hljs-string">&#x27;string&#x27;</span>
      beforetext: <span class="hljs-string">&#x27;in&#x27;</span>
    },
    {
      name: <span class="hljs-string">&#x27;this&#x27;</span>
      label: <span class="hljs-string">&#x27;search text or /regex/&#x27;</span>
      type: <span class="hljs-string">&#x27;stregex&#x27;</span>
      beforetext: <span class="hljs-string">&#x27;where&#x27;</span>
    },
    {
      name: <span class="hljs-string">&#x27;with&#x27;</span>
      label: <span class="hljs-string">&#x27;replacement&#x27;</span>
      type: <span class="hljs-string">&#x27;string&#x27;</span>
      beforetext: <span class="hljs-string">&#x27;with&#x27;</span>
    }]

  }</pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <h6 id="generate-yaml_def-">generate( yaml_def )</h6>
<p>Generates a <em>Replace</em> from an object in the yaml format</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  @generate: <span class="hljs-function"><span class="hljs-params">(yaml_def)</span> -&gt;</span>
    Errors.throw_a Errors.ValidationError, <span class="hljs-string">&#x27;No field [replace] in definition&#x27;</span>, yaml_def <span class="hljs-keyword">unless</span> yaml_def.replace?
    replace_def  = yaml_def.replace</pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <p>horrible but had problems calling an <code>@</code> function from in here</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> replace_def <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Array</span>
      replaces = <span class="hljs-keyword">for</span> replace <span class="hljs-keyword">in</span> replace_def
        Errors.throw_a Errors.ValidationError, <span class="hljs-string">&#x27;No field [field] in replace definition&#x27;</span>, yaml_def <span class="hljs-keyword">unless</span> replace.field?
        Errors.throw_a Errors.ValidationError, <span class="hljs-string">&#x27;No field [field] in replace definition&#x27;</span>, yaml_def <span class="hljs-keyword">if</span> replace.field == <span class="hljs-string">&#x27;&#x27;</span>

        Errors.throw_a Errors.ValidationError, <span class="hljs-string">&#x27;No field [this] in replace definition&#x27;</span>, yaml_def <span class="hljs-keyword">unless</span> replace.<span class="hljs-built_in">this</span>?
        Errors.throw_a Errors.ValidationError, <span class="hljs-string">&#x27;No field [with] in replace definition&#x27;</span>, yaml_def <span class="hljs-keyword">unless</span> replace.<span class="hljs-keyword">with</span>?
        <span class="hljs-keyword">if</span> is_regexy(replace.<span class="hljs-built_in">this</span>)
          replace_this = regexy_to_regex(replace.<span class="hljs-built_in">this</span>)
        <span class="hljs-keyword">else</span> 
          replace_this = replace.<span class="hljs-built_in">this</span>
        <span class="hljs-keyword">new</span> ActionReplace replace.field, replace_this, replace.<span class="hljs-keyword">with</span>

    <span class="hljs-keyword">else</span>
      Errors.throw_a Errors.ValidationError, <span class="hljs-string">&#x27;No field [field] in replace definition&#x27;</span>, yaml_def <span class="hljs-keyword">unless</span> replace_def.field?
      Errors.throw_a Errors.ValidationError, <span class="hljs-string">&#x27;No field [field] in replace definition&#x27;</span>, yaml_def <span class="hljs-keyword">if</span> replace_def.field == <span class="hljs-string">&#x27;&#x27;</span>

      Errors.throw_a Errors.ValidationError, <span class="hljs-string">&#x27;No field [this] in replace definition&#x27;</span>, yaml_def <span class="hljs-keyword">unless</span> replace_def.<span class="hljs-built_in">this</span>?
      Errors.throw_a Errors.ValidationError, <span class="hljs-string">&#x27;No field [with] in replace definition&#x27;</span>, yaml_def <span class="hljs-keyword">unless</span> replace_def.<span class="hljs-keyword">with</span>?

      debug <span class="hljs-string">&#x27;is_regexy&#x27;</span>, replace_def.<span class="hljs-built_in">this</span>, is_regexy, is_regexy(<span class="hljs-string">&#x27;test&#x27;</span>), is_regexy(<span class="hljs-string">&#x27;/test/&#x27;</span>)
      <span class="hljs-keyword">if</span> is_regexy(replace_def.<span class="hljs-built_in">this</span>)
        replace_this = regexy_to_regex(replace_def.<span class="hljs-built_in">this</span>)
      <span class="hljs-keyword">else</span> 
        replace_this = replace_def.<span class="hljs-built_in">this</span>

      <span class="hljs-keyword">new</span> ActionReplace replace_def.field, replace_this, replace_def.<span class="hljs-keyword">with</span></pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <h6 id="new-replace-field_name-serach-replace-">new Replace( field_name, serach, replace )</h6>
<p>Run an <em>Event</em> object though the <em>Replace</em> action
Note, this isn’t the plain event but the Event class</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  constructor: <span class="hljs-function"><span class="hljs-params">(@field, @this, @with)</span> -&gt;</span></pre></div></div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <p>check for emptiness
we don’t car about ‘this’ or ‘with’ as emptiness may be desired</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    throw_error <span class="hljs-string">&#x27;param 1: field&#x27;</span>  <span class="hljs-keyword">unless</span> @field?
    throw_error <span class="hljs-string">&#x27;param 2: this&#x27;</span>   <span class="hljs-keyword">unless</span> @this?
    throw_error <span class="hljs-string">&#x27;param 3: with&#x27;</span>   <span class="hljs-keyword">unless</span> @with?
    throw_error <span class="hljs-string">&#x27;param 1: field&#x27;</span>  <span class="hljs-keyword">if</span> @field == <span class="hljs-string">&#x27;&#x27;</span>
    @label = @constructor.label</pre></div></div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              <h6 id="run-event_object-">run( event_object )</h6>
<p>Run an <em>Event</em> object though the <em>Replace</em> action
Note, this isn’t the plain event but the Event class</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  run: <span class="hljs-function"><span class="hljs-params">(event_obj)</span> -&gt;</span>
    field = event_obj.get @field
    debug <span class="hljs-string">&#x27;replace run: [%s] [%s] [%s]&#x27;</span>, field, @this, @with
    new_field = <span class="hljs-string">&quot;<span class="hljs-subst">#{field}</span>&quot;</span>.replace @this, @with
    event_obj.set @field, new_field
    debug <span class="hljs-string">&#x27;replace ran: [%s]&#x27;</span>, new_field
    event_obj</pre></div></div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-47">&#182;</a>
              </div>
              <h6 id="tostring">toString()</h6>
<p>Create a human readable representation of the object</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  toString: <span class="hljs-function">-&gt;</span>
    <span class="hljs-string">&quot;replace this [<span class="hljs-subst">#{@this}</span>] with [<span class="hljs-subst">#{@with}</span>] in [<span class="hljs-subst">#{@field}</span>]&quot;</span></pre></div></div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-48">&#182;</a>
              </div>
              <h6 id="to_yaml_obj">to_yaml_obj()</h6>
<p>Turn it back into the yaml format of object</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  to_yaml_obj: <span class="hljs-function">-&gt;</span>
    obj = {}
    obj[@constructor.label] =
      field: @field
      this:  @this
      with:  @with</pre></div></div>
            
        </li>
        
        
        <li id="section-49">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-49">&#182;</a>
              </div>
              <h3 id="actionstop">ActionStop</h3>

            </div>
            
        </li>
        
        
        <li id="section-50">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-50">&#182;</a>
              </div>
              <p>This stops rule processing completely</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="hljs-class"><span class="hljs-keyword">class</span> @<span class="hljs-title">ActionStop</span> <span class="hljs-keyword">extends</span> @<span class="hljs-title">ActionBase</span></span>
  
  @label: <span class="hljs-string">&#x27;stop&#x27;</span>

  constructor: <span class="hljs-function"><span class="hljs-params">(@id)</span> -&gt;</span></pre></div></div>
            
        </li>
        
        
        <li id="section-51">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-51">&#182;</a>
              </div>
              <p>end should be a hash identifying the
RuleSet:Rule doing the ending</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    @label = @constructor.label

  run: <span class="hljs-function"><span class="hljs-params">(event_obj)</span> -&gt;</span>
    debug <span class="hljs-string">&quot;end&quot;</span>, @id
    event_obj.stop()

  toString: <span class="hljs-function">-&gt;</span>
    <span class="hljs-string">&quot;stop processing rules&quot;</span>

  to_yaml_obj: <span class="hljs-function">-&gt;</span>
    obj = {}
    obj[@constructor.label] = <span class="hljs-literal">true</span></pre></div></div>
            
        </li>
        
        
        <li id="section-52">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-52">&#182;</a>
              </div>
              <h3 id="actionstopruleset">ActionStopRuleSet</h3>

            </div>
            
        </li>
        
        
        <li id="section-53">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-53">&#182;</a>
              </div>
              <p>This stops processing for the current ruleset, but will
continue to the next</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="hljs-class"><span class="hljs-keyword">class</span> @<span class="hljs-title">ActionStopRuleSet</span> <span class="hljs-keyword">extends</span> @<span class="hljs-title">ActionBase</span></span>
  
  @label: <span class="hljs-string">&#x27;stop_rule_set&#x27;</span>

  constructor: <span class="hljs-function"><span class="hljs-params">(@id)</span> -&gt;</span></pre></div></div>
            
        </li>
        
        
        <li id="section-54">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-54">&#182;</a>
              </div>
              <p>end should be a hash identifying the
RuleSet:Rule doing the ending</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    @label = @constructor.label

  run: <span class="hljs-function"><span class="hljs-params">(event_obj)</span> -&gt;</span>
    debug <span class="hljs-string">&quot;end&quot;</span>, @id
    event_obj.stop_rule_set()

  toString: <span class="hljs-function">-&gt;</span>
    <span class="hljs-string">&quot;stop processing this rule set&quot;</span>

  to_yaml_obj: <span class="hljs-function">-&gt;</span>
    obj = {}
    obj[@constructor.label] = <span class="hljs-literal">true</span></pre></div></div>
            
        </li>
        
        
        <li id="section-55">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-55">&#182;</a>
              </div>
              <h3 id="actionnothing">ActionNothing</h3>

            </div>
            
        </li>
        
        
        <li id="section-56">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-56">&#182;</a>
              </div>
              <p>Do nothing.. no matter what is defined skip these actions
This lives in Selects as well so no actions will take effect</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="hljs-class"><span class="hljs-keyword">class</span> @<span class="hljs-title">ActionNothing</span> <span class="hljs-keyword">extends</span> @<span class="hljs-title">ActionBase</span></span>
  
  @label: <span class="hljs-string">&#x27;skip&#x27;</span>

  run: <span class="hljs-function">-&gt;</span>
    debug <span class="hljs-string">&quot;nothing&quot;</span>
    <span class="hljs-literal">true</span>

  toString: <span class="hljs-function">-&gt;</span>
    <span class="hljs-string">&quot;nothing&quot;</span>

  to_yaml_obj: <span class="hljs-function">-&gt;</span>
    o = {}
    o[@constructor.label] = <span class="hljs-literal">true</span>
    o</pre></div></div>
            
        </li>
        
        
        <li id="section-57">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-57">&#182;</a>
              </div>
              <h3 id="action">Action</h3>

            </div>
            
        </li>
        
        
        <li id="section-58">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-58">&#182;</a>
              </div>
              <p>Public interface to the Actions on a Rule</p>

            </div>
            
        </li>
        
        
        <li id="section-59">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-59">&#182;</a>
              </div>
              <p>This is a kind of factory class.
It takes the YAML definition of a rule in and sets up
an array of Actions of the required types. 
That array can then be <code>run</code> on an event and
make the required modifications.
Selects guard the event object from actions.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="hljs-class"><span class="hljs-keyword">class</span> @<span class="hljs-title">Action</span></span></pre></div></div>
            
        </li>
        
        
        <li id="section-60">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-60">&#182;</a>
              </div>
              <p>Map the yaml words to classes (should be auto Action+CamelWord)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  @types =
    discard:        self.ActionDiscard
    replace:        self.ActionReplace
    set:            self.ActionSet
    stop:           self.ActionStop
    stop_rule_set:  self.ActionStopRuleSet</pre></div></div>
            
        </li>
        
        
        <li id="section-61">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-61">&#182;</a>
              </div>
              <p>Return the list of types</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  @types_list: <span class="hljs-function">-&gt;</span>
    _.keys @types</pre></div></div>
            
        </li>
        
        
        <li id="section-62">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-62">&#182;</a>
              </div>
              <p>Build the types description object from all the different
Action types</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  @types_description = {}
  <span class="hljs-keyword">for</span> name <span class="hljs-keyword">of</span> @types
    @types_description[name] = @types[name].description()</pre></div></div>
            
        </li>
        
        
        <li id="section-63">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-63">&#182;</a>
              </div>
              <p>Generate an object from a yaml definition</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  @generate: <span class="hljs-function"><span class="hljs-params">(yaml_def)</span> -&gt;</span>
    debug <span class="hljs-string">&#x27;generate action from&#x27;</span>, yaml_def

    action_instances = []

    actions = _.intersection  _.keys(yaml_def), _.keys(@types)
    
    <span class="hljs-keyword">if</span> actions.length == <span class="hljs-number">0</span>
      msg = <span class="hljs-string">&quot;Action generate: No action found in definition&quot;</span>
      Errors.throw_a Errors.ValidationError, msg, yaml_def, _.keys(yaml_def), _.keys(@types)</pre></div></div>
            
        </li>
        
        
        <li id="section-64">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-64">&#182;</a>
              </div>
              <p>Generate the actions present in the yaml</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">for</span> action <span class="hljs-keyword">in</span> actions
      debug <span class="hljs-string">&#x27;found action&#x27;</span>, action
      action_instance = @types[action].generate yaml_def</pre></div></div>
            
        </li>
        
        
        <li id="section-65">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-65">&#182;</a>
              </div>
              <p>Should probaly check if the instances in the array are 
of the right type as well</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">unless</span> action_instance <span class="hljs-keyword">instanceof</span> self.ActionBase <span class="hljs-keyword">or</span>
             action_instance <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Array</span>
        throw_error <span class="hljs-string">&#x27;action is not of type ActionBase&#x27;</span>, action_instance
      action_instances = action_instances.concat action_instance</pre></div></div>
            
        </li>
        
        
        <li id="section-66">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-66">&#182;</a>
              </div>
              <p>Create the object</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    debug <span class="hljs-string">&#x27;built actions&#x27;</span>, action_instances
    <span class="hljs-keyword">new</span> Action action_instances</pre></div></div>
            
        </li>
        
        
        <li id="section-67">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-67">&#182;</a>
              </div>
              <p>Add a contstructor so generate can pass in <code>actions</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  constructor: <span class="hljs-function"><span class="hljs-params">(@actions)</span> -&gt;</span></pre></div></div>
            
        </li>
        
        
        <li id="section-68">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-68">&#182;</a>
              </div>
              <p>Run the event through the actions
This will generally only happen after a <em>Select</em>
has returned <code>true</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  run: <span class="hljs-function"><span class="hljs-params">(event_obj)</span> -&gt;</span>
    <span class="hljs-keyword">for</span> action <span class="hljs-keyword">in</span> @actions
      action.run event_obj
    event_obj</pre></div></div>
            
        </li>
        
        
        <li id="section-69">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-69">&#182;</a>
              </div>
              <p>Create a string for a hu-man</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  toString: <span class="hljs-function">-&gt;</span>
    (action.toString() <span class="hljs-keyword">for</span> action <span class="hljs-keyword">in</span> @actions).join <span class="hljs-string">&#x27; and &#x27;</span></pre></div></div>
            
        </li>
        
        
        <li id="section-70">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-70">&#182;</a>
              </div>
              <p>Loop through the actions and generate the object for yaml
FIXME This doesn’t deal with arrays in <code>replace:</code>!!</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  to_yaml_obj: <span class="hljs-function">-&gt;</span>
    o = {}
    <span class="hljs-keyword">for</span> action <span class="hljs-keyword">in</span> @actions
      <span class="hljs-keyword">if</span> action <span class="hljs-keyword">is</span> <span class="hljs-string">&#x27;replace&#x27;</span>
        o.replace = [] <span class="hljs-keyword">unless</span> o.replace
        o.replace.push action.to_yaml_obj().replace
      <span class="hljs-keyword">else</span>
        _.defaults o, action.to_yaml_obj()
    o</pre></div></div>
            
        </li>
        
        
        <li id="section-71">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-71">&#182;</a>
              </div>
              <p>Convert the object into yaml</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  to_yaml: <span class="hljs-function">-&gt;</span>
    yaml.dump @to_yaml_obj()</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
