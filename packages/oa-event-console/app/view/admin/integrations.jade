//- 
//- Copyright (C) 2020, Open Answers Ltd http://www.openanswers.co.uk/
//- All rights reserved.
//- This file is subject to the terms and conditions defined in the Software License Agreement.
//-  


block template
  
  //- Render zendesk template
  script(id="admin-integrations-zendesk-template" type="text/x-mustache-template")
    //- Header
    tr
      th.col-xs-4 Subdomain
      th.col-xs-4 Email
      th.col-xs-4 Auth
    tr
      td.col-xs-4 {{subdomain}}.zendesk.com
      td.col-xs-4 {{email}}
      td.col-xs-4 {{password}} or {{token}}
    tr
      td.col-xs-12 {{body}} one line of


  //- Render zendesk template
  script(id="admin-integrations-zendesk-edit-template" type="text/x-mustache-template")
    //- Header
    tr.admin-integration-row-edit(id="integration-edit-{{_id}}" data-id="{{_id}}" data-integration="{{name}}")
      td.col-xs-12.editing(colspan="3")
        form.admin-integration-row-edit-form(data-id="{{_id}}")
          .row
            input.form-control(type='hidden' name='_id' value='{{_id}}')
            .col-xs-12.form-group.has-error
              .control-label Subdomain
              input.form-control(type='text' 
                name='subdomain' 
                data-error='You must enter a zendesk subdomain' 
                value='{{subdomain}}')
              span.input-group-addon @zendesk.com
            .col-xs-2
              input.form-control(type='text'
                name='email' 
                value='{{email}}')
            .col-xs-5
              button#admin-integration-row-save-edit-submit.btn.btn-success.admin-integration-row-save.marginright5(type='submit' value='Save') Save
              button.btn.btn-primary.admin-integration-row-cancel.marginright5(type="button") Cancel
              button.btn.btn-danger.admin-integration-row-delete.marginright5(type="button") Delete


  //- Render zendesk template
  script(id="admin-integrations-zendesk-create-template" type="text/x-mustache-template")
    //- Header
    .row
      .form-group
        label.control-label.col-sm-4.col-md-3.col-lg-2 Name
        .col-sm-8.col-md-5.col-lg-4
          input.form-control(type='text'
            name='name' 
            placeholder='This name will appear in the context menu')
      .form-group
        label.control-label.col-sm-4.col-md-3.col-lg-2 Subdomain
        .col-sm-8.col-md-5.col-lg-4
          .input-group
            input.form-control(type='text' 
              name='zendesk_subdomain' 
              data-error='You must enter a zendesk subdomain'
              placeholder='your-domain'
              value='{{subdomain}}')
            span.input-group-addon @zendesk.com
      .form-group
        label.control-label.col-sm-4.col-md-3.col-lg-2 Email
        .col-sm-8.col-md-5.col-lg-4
          input.form-control(type='email'
            name='zendesk_email' 
            placeholder='email@domain.com'
            required)
      .form-group
        label.control-label.col-sm-4.col-md-3.col-lg-2 Authentication
        .col-sm-8.col-md-5.col-lg-4
          .input-group
            .input-group-btn
              button.btn.btn-default.dropdown-toggle(data-toggle='dropdown')
                span#admin-integrations-zendesk-create-auth Token
                |&nbsp;
                span.caret
              ul.dropdown-menu(role='menu')
                li 
                  a(onclick="$('#admin-integrations-zendesk-create-auth').html('Token')") Token
                li
                  a(onclick="$('#admin-integrations-zendesk-create-auth').html('Password')") Password
            input.form-control(type='text'
              name='email' 
              placeholder='Token or Password')
      label.col-sm-4.col-md-3.col-lg-2.divider Ticket Settings
      .form-group
        label.control-label.col-sm-4.col-md-3.col-lg-2 Type
        .col-sm-8.col-md-5.col-lg-4
          select.form-control(name='zendesk_api_type')
            option(value='incident') Incident
            option(value='problem') Problem
            option(value='question') Question
            option(value='task') Task
      .form-group
        label.control-label.col-sm-4.col-md-3.col-lg-2 Priority
        .col-sm-8.col-md-5.col-lg-4
          select.form-control(name='zendesk_api_type')
            option(value='urgent') Urgent
            option(value='high') High
            option(value='normal') Normal
            option(value='low') Low
      .form-group
        label.control-label.col-sm-4.col-md-3.col-lg-2 Subject
        .col-sm-8.col-md-5.col-lg-4
          input.form-control(name='zendesk_api_subject' type='text' placeholder='Use {field} for event data')
      .form-group
        label.control-label.col-sm-4.col-md-3.col-lg-2 Comment
        .col-sm-8.col-md-5.col-lg-4
          input.form-control(name='zendesk_api_comment' type='text' placeholder='Use {field} for event data')
      .form-group
        .col-sm-4.col-md-3.col-lg-2
        .col-sm-8.col-md-5.col-lg-4
          button#admin-integration-zendesk-create-submit.btn.btn-success.admin-integration-row-save.marginright5(type='submit' value='Add') Add
          button.btn.btn-primary.admin-integration-row-cancel.marginright5(type="button") Cancel


  //- Render http template
  script(id="admin-integrations-ses-template" type="text/x-mustache-template")
    //- Header
    tr
      th.col-xs-2 URL
      th.col-xs-3 Username
      th.col-xs-3 Password
      th.col-xs-4 Header
    tr
      td.col-xs-2 {{url}}
      td.col-xs-3 {{username}}
      td.col-xs-3 {{password}}
      td.col-xs-4 {{header}}
    tr
      td.col-xs-12 {{body}}


  //- Render http template
  script(id="admin-integrations-ses-create-template" type="text/x-mustache-template")
    .row
      .form-group
        label.control-label.col-sm-4.col-md-3.col-lg-2 Name
        .col-sm-8.col-md-5.col-lg-4
          input.form-control(type='text'
            name='name' 
            placeholder='This name will appear in the context menu')
      .form-group
        label.control-label.col-sm-4.col-md-3.col-lg-2 AWS Access Key
        .col-sm-8.col-md-5.col-lg-4
          input.form-control(type='text'
            name='auth_aws_key' 
            placeholder='AWS Secure Key')
      .form-group
        label.control-label.col-sm-4.col-md-3.col-lg-2 Email
        .col-sm-8.col-md-5.col-lg-4
          input.form-control(type='text'
            name='email_destination' 
            placeholder='to-email@domain.com')
      .form-group
        label.control-label.col-sm-4.col-md-3.col-lg-2 Subject
        .col-sm-8.col-md-5.col-lg-4
          input.form-control(type='text'
            name='subject' 
            placeholder='Subject with {fields}')
      .form-group
        label.control-label.col-sm-4.col-md-3.col-lg-2 Body
        .col-sm-8.col-md-5.col-lg-4
          input.form-control(type='text'
            name='body' 
            placeholder='Body of the email. Can contain event {fields}')


  //- Render http template
  script(id="admin-integrations-http-template" type="text/x-mustache-template")
    //- Header
    tr
      th.col-xs-2 URL
      th.col-xs-3 Username
      th.col-xs-3 Password
      th.col-xs-4 Header
    tr
      td.col-xs-2 {{url}}
      td.col-xs-3 {{username}}
      td.col-xs-3 {{password}}
      td.col-xs-4 {{header}}
    tr
      td.col-xs-12 {{body}}


  //- Render http template
  script(id="admin-integrations-http-create-template" type="text/x-mustache-template")
    //- Header
    .row
      .form-group
        label.control-label.col-sm-4.col-md-3.col-lg-2 Name
        .col-sm-8.col-md-5.col-lg-4
          input.form-control(type='text'
            name='name' 
            placeholder='This name will appear in the context menu')
      .form-group
        label.control-label.col-sm-4.col-md-3.col-lg-2 Method
        .col-sm-8.col-md-5.col-lg-4
          select.form-control(name='method')
            option GET
            option POST
            option PUT
            option DELETE
      .form-group
        label.control-label.col-sm-4.col-md-3.col-lg-2 URL
        .col-sm-8.col-md-5.col-lg-4
          input.form-control(type='text' 
            name='url' 
            data-error='You must enter a valid URL'
            placeholder='https://your.api/url')
      .form-group
        label.control-label.col-sm-4.col-md-3.col-lg-2 Header1
        .col-sm-8.col-md-5.col-lg-4
          input.form-control(type='text'
            name='header_1' 
            placeholder='Name: Value')
      .form-group
        label.control-label.col-sm-4.col-md-3.col-lg-2 Header2
        .col-sm-8.col-md-5.col-lg-4
          input.form-control(type='text'
            name='header_2' 
            placeholder='Name: Value')
      .form-group
        label.control-label.col-sm-4.col-md-3.col-lg-2 Body
        .col-sm-8.col-md-5.col-lg-4
          textarea.form-control(name='body' 
            placeholder="Request Body. Use {field} to insert event data")
      .form-group
        .col-sm-4.col-md-3.col-lg-2
        .col-sm-8.col-md-5.col-lg-4
          button#admin-integration-zendesk-create-submit.btn.btn-success.admin-integration-row-save.marginright5(type='submit' value='Add') Add
          button.btn.btn-primary.admin-integration-row-cancel.marginright5(type="button") Cancel



  //- Render initial view Template
  script(id="admin-integrations-template" type="text/x-mustache-template")
    
    //- Header
    tr
      th.col-xs-3 Name
      th.col-xs-3 Type
      th.col-xs-6 Info

    //- Display
    |{{ #integrations }}

    tr.admin-integration-row(id="integration-{{_id}}" data-id="{{_id}}" data-integration="{{integrationname}}")
      th.col-xs-3 {{ name }}
      th.col-xs-3 {{ type }}
      th.col-xs-6 {{ info }}
    
    |{{ /integrations }}


//- Container content
table#admin-integrations-table.table.table_nested.table-hover
  //- This is where the integrations/integration data ends up

//- Form to create integrations
.col-xs-12.marginbottom15
  form#admin-integrations-create.form-horizontal
    .row
      .col-xs-12.col-sm-6.col-md-4.col-lg-3
        .form-group
          select.form-control(name='type' placeholder='Choose...' )
            option(value='') Choose...
            option(value='zendesk') Zendesk
            option(value='ses') Amazon SES Email
            option(value='sns') Amazon SNS Notification
            option(value='http') HTTP
    #admin-integrations-create-type