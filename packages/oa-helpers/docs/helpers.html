<!DOCTYPE html>

<html>
<head>
  <title>helpers.coffee</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page_wrapper">
            <div id="jump_page">
              
                
                <a class="source" href="helpers.html">
                  helpers.coffee
                </a>
              
                
                <a class="source" href="objhash.html">
                  objhash.coffee
                </a>
              
            </div>
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>helpers.coffee</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>node modules</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>util     = <span class="hljs-built_in">require</span> <span class="hljs-string">&#x27;util&#x27;</span>
crypto   = <span class="hljs-built_in">require</span> <span class="hljs-string">&#x27;crypto&#x27;</span></pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>npm modules</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>_        = <span class="hljs-built_in">require</span> <span class="hljs-string">&#x27;lodash&#x27;</span>
bluebird = <span class="hljs-built_in">require</span> <span class="hljs-string">&#x27;bluebird&#x27;</span>
uuid     = <span class="hljs-built_in">require</span> <span class="hljs-string">&#x27;node-uuid&#x27;</span>
debug    = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;debug&#x27;</span>)(<span class="hljs-string">&#x27;oa:helpers&#x27;</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>oa modules</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>objhash = <span class="hljs-built_in">require</span> <span class="hljs-string">&#x27;./objhash&#x27;</span>

bluebird.promisifyAll crypto</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <h2 id="helpers">Helpers</h2>

            </div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>Helpers are a bunch of generic javascript helpers that are missing from
core js and might be useful for other projects</p>

            </div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>The Helpers class is just a namespace to be easily exported at the end
You can call all the functions directly when you require oa-helpers</p>

            </div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <pre><code>Helpers = <span class="hljs-built_in">require</span> <span class="hljs-string">&#x27;oa-helpers&#x27;</span>
Helpers.ends_with <span class="hljs-string">&quot;last&quot;</span>, <span class="hljs-string">&quot;st&quot;</span></code></pre>

            </div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>Or with coffeescripts object derefence shortcut</p>

            </div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <pre><code>{ ends_with } = <span class="hljs-built_in">require</span> <span class="hljs-string">&#x27;oa-helpers&#x27;</span>
ends_with <span class="hljs-string">&quot;last&quot;</span>, <span class="hljs-string">&quot;st&quot;</span></code></pre>

            </div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>JS</p>

            </div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <pre><code>ends_with = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;oa-helpers&#x27;</span>).ends_with
ends_with(<span class="hljs-string">&quot;last&quot;</span>, <span class="hljs-string">&quot;st&quot;</span>)</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Helpers</span></span></pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>Give everyone access to our lodash, uuid and bluebird</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  @_: _
  @uuid: uuid
  @bluebird: bluebird
  @Promise: bluebird</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <h4 id="objhash"><code>objhash</code></h4>
<p>Create a consistant sha hash of an unordered JS object</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  @objhash: objhash</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <h4 id="delay-timeout-fn-"><code>.delay( timeout, fn )</code></h4>
<p>Switch setTimeout arguments around for coffee niceness</p>
<pre><code>delay <span class="hljs-number">5000</span>, <span class="hljs-function">-&gt;</span>
  do_something_delayed()</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>
  @delay: <span class="hljs-function"><span class="hljs-params">( timeout, cb )</span> -&gt;</span>
    <span class="hljs-built_in">setTimeout</span> cb, timeout</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <h6 id="map_object-obj--mapping-">.map_object( obj , mapping )</h6>
<p>To map properties of an object to new properties.
Returns <code>undefined</code>, as it modifies original object</p>
<pre><code>obj = { one: <span class="hljs-number">1</span>, two: <span class="hljs-number">2</span>}
map_object(obj, { one: <span class="hljs-string">&#x27;new&#x27;</span> });
<span class="hljs-comment"># =&gt; undefined</span>
obj
<span class="hljs-comment"># =&gt; { new: 1, two: 2 }</span></code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>
  @map_object: <span class="hljs-function"><span class="hljs-params">( obj , mapping )</span> -&gt;</span>
    <span class="hljs-keyword">for</span> <span class="hljs-keyword">from</span>, to <span class="hljs-keyword">of</span> mapping
      <span class="hljs-keyword">if</span> obj[<span class="hljs-keyword">from</span>]?
        obj[to] = obj[<span class="hljs-keyword">from</span>]
        <span class="hljs-keyword">delete</span> obj[<span class="hljs-keyword">from</span>]
      <span class="hljs-keyword">else</span>
        obj[to] = <span class="hljs-literal">undefined</span>
    <span class="hljs-literal">undefined</span></pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <h6 id="map_objects-array-mapping-">.map_objects( array, mapping )</h6>
<p>Run object mapping across an array of objects
See <code>map_object</code> for mapping setup</p>
<pre><code>map_objects( obj_array, { one: <span class="hljs-string">&#x27;new&#x27;</span> });</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>
  @map_objects: <span class="hljs-function"><span class="hljs-params">( array, mapping )</span> -&gt;</span>
    <span class="hljs-keyword">for</span> obj <span class="hljs-keyword">in</span> array
      Helpers.map_object obj, mapping
    <span class="hljs-literal">undefined</span></pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <h6 id="mapped_object-array-mapping-">.mapped_object( array, mapping )</h6>
<p>see <code>map_object</code>, returns new object
could be quicker but meh
Note this is not a deep clone</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  @map_clone_object: <span class="hljs-function"><span class="hljs-params">( obj, mapping )</span> -&gt;</span>
    obj = _.clone obj
    Helpers.map_object obj, mapping
    obj</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <h6 id="mapped_objects-array-mapping-">.mapped_objects( array, mapping )</h6>
<p>see <code>map_objects</code>, returns new objects</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  @map_clone_objects: <span class="hljs-function"><span class="hljs-params">( obj, mapping )</span> -&gt;</span>
    <span class="hljs-keyword">for</span> obj <span class="hljs-keyword">in</span> array
      Helpers.map_clone_object obj, mapping</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <h6 id="ends_with-str-ending-">ends_with( str, ending )</h6>
<p>Check if a string ends with a certain string
Returns true/false</p>
<pre><code>ends_with(<span class="hljs-string">&#x27;abc&#x27;</span>, <span class="hljs-string">&#x27;c&#x27;</span>);
<span class="hljs-regexp">//</span> =&gt; <span class="hljs-literal">true</span>

ends_with(<span class="hljs-string">&#x27;abc&#x27;</span>, <span class="hljs-string">&#x27;d&#x27;</span>);
<span class="hljs-regexp">//</span> =&gt; <span class="hljs-literal">false</span></code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>  @ends_with: <span class="hljs-function"><span class="hljs-params">(str, end)</span> -&gt;</span>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span> <span class="hljs-keyword">unless</span> _.isString str
    len = str.length - end.length
    str.indexOf( end, len ) != <span class="hljs-number">-1</span></pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <h6 id="starts_with-str-start-">starts_with( str, start )</h6>
<p>Check if a string starts with a certain string
Returns true/false</p>
<pre><code>starts_with(<span class="hljs-string">&#x27;abc&#x27;</span>, <span class="hljs-string">&#x27;a&#x27;</span>);
<span class="hljs-regexp">//</span> =&gt; <span class="hljs-literal">true</span>

starts_with(<span class="hljs-string">&#x27;abc&#x27;</span>, <span class="hljs-string">&#x27;z&#x27;</span>);
<span class="hljs-regexp">//</span> =&gt; <span class="hljs-literal">false</span></code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>  @starts_with: <span class="hljs-function"><span class="hljs-params">(str, start)</span> -&gt;</span>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span> <span class="hljs-keyword">unless</span> _.isString str
    str.lastIndexOf( start, <span class="hljs-number">0</span> ) == <span class="hljs-number">0</span></pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <h6 id="format_string-string-variables-">format_string( string, variables… )</h6>
<p>Take a string like {whatever} and replace with the
variable { whatever: ‘value’ }</p>
<p>Implementation of stacks string formatter
<a href="http://stackoverflow.com/a/23087471/1318694">http://stackoverflow.com/a/23087471/1318694</a></p>
<pre><code>format_string( <span class="hljs-string">&#x27;wha{wha}wha&#x27;</span>, { wha: <span class="hljs-number">2</span> } );
<span class="hljs-regexp">//</span> =&gt; wha2wha</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>  @format_string: <span class="hljs-function"><span class="hljs-params">( str, args... )</span>-&gt;</span>
    <span class="hljs-keyword">return</span> str <span class="hljs-keyword">if</span> <span class="hljs-keyword">typeof</span> str <span class="hljs-keyword">isnt</span> <span class="hljs-string">&#x27;string&#x27;</span>
    <span class="hljs-keyword">return</span> str <span class="hljs-keyword">unless</span> args
    <span class="hljs-keyword">return</span> str <span class="hljs-keyword">unless</span> str.indexOf(<span class="hljs-string">&#x27;{&#x27;</span>) &gt; <span class="hljs-number">-1</span> <span class="hljs-keyword">and</span> str.indexOf(<span class="hljs-string">&#x27;}&#x27;</span>) &gt; <span class="hljs-number">-1</span>
    args = args[<span class="hljs-number">0</span>] <span class="hljs-keyword">if</span> <span class="hljs-keyword">typeof</span> args[<span class="hljs-number">0</span>] <span class="hljs-keyword">is</span> <span class="hljs-string">&#x27;object&#x27;</span>
    <span class="hljs-keyword">for</span> arg <span class="hljs-keyword">of</span> args
      re  = <span class="hljs-built_in">RegExp</span> <span class="hljs-string">&quot;\\{<span class="hljs-subst">#{arg}</span>\\}&quot;</span>, <span class="hljs-string">&quot;gi&quot;</span>
      lookedup = _.get( args, arg )
      got = <span class="hljs-keyword">if</span> <span class="hljs-keyword">typeof</span> lookedup <span class="hljs-keyword">is</span> <span class="hljs-string">&#x27;string&#x27;</span>
        lookedup
      <span class="hljs-keyword">else</span>
        <span class="hljs-keyword">try</span>
          <span class="hljs-built_in">JSON</span>.stringify lookedup
        <span class="hljs-keyword">catch</span> error
          debug <span class="hljs-string">&quot;Error &quot;</span>, error
          <span class="hljs-string">&quot;&quot;</span>

      str = str.replace re, got
      <span class="hljs-keyword">return</span> str <span class="hljs-keyword">unless</span> str.indexOf(<span class="hljs-string">&#x27;{&#x27;</span>) &gt; <span class="hljs-number">-1</span>
    <span class="hljs-keyword">return</span> str</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <h6 id="format_string_object-string-object-">format_string_object( string, object )</h6>
<p>Take a string like <code>a {what} b</code> and replace with the property <code>what</code></p>
<pre><code>format_string_object( <span class="hljs-string">&#x27;a {what} b&#x27;</span>, {what: <span class="hljs-string">&#x27;value&#x27;</span>} )</code></pre>
<p>Like <code>format_string()</code> except purely for objects
Can use <code>.</code> notation to access sub properties of the object.
This does the replace the opposite way to <code>format_string</code>, it finds the
key name from the string and then looks up the key in the object. Should
be faster when using large objects with many properties.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  @format_string_re = <span class="hljs-built_in">RegExp</span> <span class="hljs-string">&quot;\\{(.+?)\\}&quot;</span>, <span class="hljs-string">&quot;ig&quot;</span>
  @format_string_object: <span class="hljs-function"><span class="hljs-params">( str, object )</span>-&gt;</span>
    debug <span class="hljs-string">&#x27;format_string_object str&#x27;</span>, str
    <span class="hljs-keyword">return</span> str <span class="hljs-keyword">if</span> <span class="hljs-keyword">typeof</span> str <span class="hljs-keyword">isnt</span> <span class="hljs-string">&#x27;string&#x27;</span>
    <span class="hljs-keyword">return</span> str <span class="hljs-keyword">unless</span> object
    <span class="hljs-keyword">return</span> str <span class="hljs-keyword">unless</span> matches = str.match(Helpers.format_string_re)
    debug <span class="hljs-string">&#x27;format_string_object matches&#x27;</span>, matches
    <span class="hljs-keyword">for</span> match <span class="hljs-keyword">in</span> matches
      key = match.slice <span class="hljs-number">1</span>, <span class="hljs-number">-1</span>
      val = _.get object, key
      <span class="hljs-keyword">if</span> val <span class="hljs-keyword">isnt</span> <span class="hljs-literal">undefined</span> <span class="hljs-keyword">and</span> val <span class="hljs-keyword">isnt</span> <span class="hljs-literal">null</span>
        str = str.replace match, val
        debug <span class="hljs-string">&#x27;format_string_object new str m[%s] v[%s] str[%s]&#x27;</span>, match, val, str

    <span class="hljs-keyword">return</span> str</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <h6 id="ensure_array-value-">ensure_array( value )</h6>
<p>Turn a variable into an array element if it isnt an Array
Useful for fields that can be either singular or arrays</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
  @ensure_array: <span class="hljs-function"><span class="hljs-params">( some_var )</span> -&gt;</span>
    some_var = <span class="hljs-built_in">Array</span> some_var <span class="hljs-keyword">unless</span> some_var <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Array</span>
    some_var</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <h6 id="throw_error-message-vars-">throw_error( message, vars… )</h6>
<p>Simple error thrower that can include formatted
variables in the message</p>
<p>Create a [] enclosed string from each variable argument</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
  @throw_error: <span class="hljs-function"><span class="hljs-params">( message, vars... )</span> -&gt;</span>
    var_str = <span class="hljs-string">&#x27;&#x27;</span>
    <span class="hljs-keyword">if</span> vars.length &gt; <span class="hljs-number">0</span>
      var_join = ( util.inspect(vari) <span class="hljs-keyword">for</span> vari <span class="hljs-keyword">in</span> vars ).join <span class="hljs-string">&#x27;] [&#x27;</span>
      var_str = <span class="hljs-string">&quot; [<span class="hljs-subst">#{var_join}</span>]&quot;</span>

    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span> <span class="hljs-string">&quot;<span class="hljs-subst">#{message}</span><span class="hljs-subst">#{var_str}</span>&quot;</span></pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <h6 id="regex_escape-string-">.regex_escape( string )</h6>
<p>Function to create a string with all special regex
characters escaped</p>
<p>Returns a new string with escaped regex characters</p>
<pre><code>regex_escape(<span class="hljs-string">&#x27;a\d+5]&#x27;</span>);
<span class="hljs-regexp">//</span> =&gt; <span class="hljs-string">&#x27;a\\d+5\]&#x27;</span></code></pre>
<p><a href="http://stackoverflow.com/a/494122">http://stackoverflow.com/a/494122</a>
<a href="http://stackoverflow.com/users/48077/gracenotes">http://stackoverflow.com/users/48077/gracenotes</a></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  @re_quote_special: <span class="hljs-regexp">///
      (           <span class="hljs-comment"># group</span>
        [.?*+^$[\]\\(){}|-] <span class="hljs-comment"># and match any of the re special chars</span>
      )
    ///</span>g          <span class="hljs-comment">#globally</span>

  @regex_escape: <span class="hljs-function"><span class="hljs-params">( string )</span> -&gt;</span>
    string.replace Helpers.re_quote_special, <span class="hljs-string">&#x27;\\$1&#x27;</span></pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <h6 id="regex_from_array--values-">regex_from_array: ( values )</h6>
<p>Return an <code>or</code> regex from an array of values</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  @regex_from_array: <span class="hljs-function"><span class="hljs-params">( values )</span> -&gt;</span></pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>Build strings for <code>new RegExp</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    regex_values = <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> values
      <span class="hljs-keyword">if</span> item <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">RegExp</span>
        item.source
      <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> Helpers.is_regexy item
        Helpers.regexy_to_string item
      <span class="hljs-keyword">else</span>
        Helpers.regex_escape <span class="hljs-string">&quot;<span class="hljs-subst">#{item}</span>&quot;</span></pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>Return a new regexp</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">new</span> <span class="hljs-built_in">RegExp</span> regex_values.join(<span class="hljs-string">&#x27;|&#x27;</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <h6 id="under_to_class-string-">under_to_class( string )</h6>
<p>Take an underscored_word and turns it into
a ClassWord</p>
<pre><code>under_to_class(<span class="hljs-string">&#x27;test_this_thing&#x27;</span>)
<span class="hljs-comment"># =&gt; TestThisThing</span></code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>
  @under_to_class: <span class="hljs-function"><span class="hljs-params">( underscored )</span> -&gt;</span></pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>First word</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    semi_class = underscored.replace <span class="hljs-regexp">/^[a-z]/</span>, <span class="hljs-function"><span class="hljs-params">(g)</span>-&gt;</span>
      g.toUpperCase()</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>Any other word starting with _</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    semi_class.replace <span class="hljs-regexp">/_[a-z]/g</span>, <span class="hljs-function"><span class="hljs-params">(g)</span>-&gt;</span>
      g[<span class="hljs-number">1</span>].toUpperCase()</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <h6 id="class_to_under-string-">class_to_under( string )</h6>
<p>Take a ClassWord and return a underscored version</p>
<pre><code>class_to_under(<span class="hljs-string">&#x27;TestThisThing&#x27;</span>)
<span class="hljs-comment"># =&gt; test_this_thing</span></code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>  @class_to_under: <span class="hljs-function"><span class="hljs-params">( classed )</span>-&gt;</span></pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p>First word</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    semi_under = classed.replace <span class="hljs-regexp">/^[A-Z]/</span>, <span class="hljs-function"><span class="hljs-params">(g)</span>-&gt;</span>
      g.toLowerCase()</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>Any other word with a capital
It will get tripped up on something like AcePAC</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    semi_under.replace <span class="hljs-regexp">/[A-Z]/g</span>, <span class="hljs-function"><span class="hljs-params">(g)</span>-&gt;</span>
      <span class="hljs-string">&#x27;_&#x27;</span> + g.toLowerCase()</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p>Test if a var is numeric
For some reason js thinks ‘’ is numeric</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  @is_numeric: <span class="hljs-function"><span class="hljs-params">( val )</span>-&gt;</span>
    !<span class="hljs-built_in">isNaN</span>(val) <span class="hljs-keyword">and</span> val <span class="hljs-keyword">isnt</span> <span class="hljs-string">&#x27;&#x27;</span></pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p>Test if a string is regex delimited</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  @is_regexy: <span class="hljs-function"><span class="hljs-params">( val )</span>-&gt;</span>
    !!( _.isString(val) <span class="hljs-keyword">and</span>
      Helpers.starts_with(val, <span class="hljs-string">&#x27;/&#x27;</span>) <span class="hljs-keyword">and</span>
      val.match(<span class="hljs-regexp">/\/[img]*$/</span>) )</pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <h6 id="is_stringy-quoted_string-">is_stringy( quoted_string )</h6>
<p>Tests if a string is quoted, forcing stringyness</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  @is_stringy: <span class="hljs-function"><span class="hljs-params">( val )</span>-&gt;</span>
    _.isString(val) <span class="hljs-keyword">and</span>
    ( Helpers.starts_with( val, <span class="hljs-string">&quot;&#x27;&quot;</span> ) <span class="hljs-keyword">and</span> Helpers.ends_with( val, <span class="hljs-string">&quot;&#x27;&quot;</span> )) <span class="hljs-keyword">or</span>
    ( Helpers.starts_with( val, <span class="hljs-string">&#x27;&quot;&#x27;</span> ) <span class="hljs-keyword">and</span> Helpers.ends_with( val, <span class="hljs-string">&#x27;&quot;&#x27;</span> ))</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <h6 id="regexy_to_string-stregex-">regexy_to_string( stregex )</h6>
<p>Test if a string is regex delimited, if it is turn is into a regexp
If there is a modifier as well, return an array or strings</p>

            </div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <p>   regexy_to_string( /test/ )
   =&gt; ‘test’</p>

            </div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <p>   regexy_to_string( /test/m )
   =&gt; [ ‘test’, ‘m’ ]</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
  @regexy_to_string: <span class="hljs-function"><span class="hljs-params">( val )</span>-&gt;</span>
    <span class="hljs-keyword">if</span> _.isString(val)
      match = val.match <span class="hljs-regexp">/^\/(.*)\/([img]*)$/</span>
    <span class="hljs-keyword">if</span> match
      <span class="hljs-keyword">if</span> match[<span class="hljs-number">2</span>]
        <span class="hljs-keyword">return</span> [ match[<span class="hljs-number">1</span>], match[<span class="hljs-number">2</span>] ]
      <span class="hljs-keyword">else</span>
        <span class="hljs-keyword">return</span> match[<span class="hljs-number">1</span>]
    <span class="hljs-keyword">else</span>
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span> <span class="hljs-string">&#x27;Regexy match failed for [&#x27;</span>+val+<span class="hljs-string">&#x27;] [&#x27;</span>+match+<span class="hljs-string">&#x27;]&#x27;</span></pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <h6 id="regexy_to_regex-stregex-">regexy_to_regex( stregex )</h6>
<p>Test if a string is regex delimited, if it is turn is into a regexp</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  @regexy_to_regex: <span class="hljs-function"><span class="hljs-params">( val )</span>-&gt;</span>
    regex_components = Helpers.ensure_array Helpers.regexy_to_string(val)
    <span class="hljs-keyword">new</span> <span class="hljs-built_in">RegExp</span> regex_components...</pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <p>Remove a single value from an array and add new value
Useful for css class arrays</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  @array_replace: <span class="hljs-function"><span class="hljs-params">( array, new_val, old_val )</span>-&gt;</span>
    idx = array.indexOf old_val
    array.splice idx, <span class="hljs-number">1</span>, new_val</pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <h3 id="random_string-length-char_set-">random_string( length, char_set )</h3>
<p>Generate a random base64ish string</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
  @rand_numbers: <span class="hljs-string">&#x27;0123456789&#x27;</span>
  @rand_lower:  <span class="hljs-string">&#x27;abcdefghijklmnopqrstuvwxyz&#x27;</span>
  @rand_upper:  @rand_lower.toUpperCase()
  @rand_chars:  @rand_numbers + @rand_lower + @rand_upper
  @base64_chars: @rand_chars + <span class="hljs-string">&#x27;-_&#x27;</span>
  @base32_chars: @rand_numbers + <span class="hljs-string">&#x27;abcdefghijklmnopqrstuv&#x27;</span>

  @random_string: <span class="hljs-function"><span class="hljs-params">( length, chars = Helpers.rand_chars )</span>-&gt;</span>
    string = <span class="hljs-keyword">for</span> [<span class="hljs-number">1.</span>.length]
      n = <span class="hljs-built_in">Math</span>.floor( <span class="hljs-built_in">Math</span>.random() * chars.length )
      chars.substring( n, n+<span class="hljs-number">1</span> )
    string.join <span class="hljs-string">&#x27;&#x27;</span>


  @crypto_random_hex: <span class="hljs-function"><span class="hljs-params">( bytes )</span>-&gt;</span>
    buf = crypto.randomBytes(bytes)
    {
      bytes: buf
      string: buf.toString(<span class="hljs-string">&#x27;hex&#x27;</span>)
    }

  @crypto_random_base64: <span class="hljs-function"><span class="hljs-params">( bytes )</span>-&gt;</span>
    buf = crypto.randomBytes(bytes)
    {
      bytes: buf
      string: buf.toString(<span class="hljs-string">&#x27;base64&#x27;</span>)
    }

  @crypto_random_base64_url: <span class="hljs-function"><span class="hljs-params">( bytes )</span>-&gt;</span>
    res = Helpers.crypto_random_base64( bytes )
    res.string = res.string
      .replace <span class="hljs-regexp">/\//g</span>, <span class="hljs-string">&#x27;_&#x27;</span>
      .replace <span class="hljs-regexp">/\+/g</span>, <span class="hljs-string">&#x27;-&#x27;</span>
      .replace <span class="hljs-regexp">/\=/g</span>, <span class="hljs-string">&#x27;&#x27;</span></pre></div></div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <p>No nice base62 for node, without delving into it, base64 does
most of what we want and probably better than I can.</p>

            </div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              <p>This is not a value you can convert back to a buffer, just a 
random string</p>

            </div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-47">&#182;</a>
              </div>
              <p>A couple of bits on the end might not be as random but ¯_(ツ)_/¯</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
  @crypto_random_base62_string: <span class="hljs-function"><span class="hljs-params">( length )</span>-&gt;</span>
    string = crypto.randomBytes(length+<span class="hljs-number">3</span>).toString <span class="hljs-string">&#x27;base64&#x27;</span>
    Helpers.base62_from_base64 string, length

  @crypto_random_base62_string_async: <span class="hljs-function"><span class="hljs-params">( length )</span>-&gt;</span>
    crypto.randomBytesAsync(length)
      .<span class="hljs-keyword">then</span> (buf)-&gt;
        string = buf.toString <span class="hljs-string">&#x27;base64&#x27;</span>
        Helpers.base62_from_base64 string, length

  @base62_from_base64: <span class="hljs-function"><span class="hljs-params">( b64string, length )</span>-&gt;</span></pre></div></div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-48">&#182;</a>
              </div>
              <p>Remove the <code>=</code> padding and any non full bytes on the end</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">unless</span> length % <span class="hljs-number">3</span> <span class="hljs-keyword">is</span> <span class="hljs-number">0</span>
      rem = <span class="hljs-number">0</span> - (length % <span class="hljs-number">3</span>) - <span class="hljs-number">1</span>
      b64string = b64string.slice(<span class="hljs-number">0</span>,rem)</pre></div></div>
            
        </li>
        
        
        <li id="section-49">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-49">&#182;</a>
              </div>
              <p>Remove the 2 base64 chars</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    string = b64string
      .replace <span class="hljs-regexp">/\+|\//g</span>, <span class="hljs-string">&#x27;&#x27;</span>

    <span class="hljs-keyword">if</span> string.length <span class="hljs-keyword">is</span> length
      <span class="hljs-keyword">return</span> string
    
    <span class="hljs-keyword">if</span> string.length &gt; length
      <span class="hljs-keyword">return</span> string.slice(<span class="hljs-number">0</span>,length)

    <span class="hljs-keyword">if</span> string.length &lt; length
      debug <span class="hljs-string">&#x27;base62_from_base64 was short&#x27;</span>, length, string.length
      new_string = @crypto_random_base62_string(length)
      string = (string + new_string).slice(<span class="hljs-number">0</span>, length)

    <span class="hljs-keyword">if</span> string.length &lt; length
      debug <span class="hljs-string">&#x27;base62_from_base64 was really short&#x27;</span>, length, string.length
      new_string = @crypto_random_base62_string( <span class="hljs-built_in">Math</span>.ceil(string.length / <span class="hljs-number">2</span>) )
      string = (string + new_string).slice(<span class="hljs-number">0</span>, length)

    <span class="hljs-keyword">if</span> string.length &lt; length
      debug <span class="hljs-string">&quot;base62_from_base64 had too many /&#x27;s and +&#x27;s 3 times&quot;</span>
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span> <span class="hljs-string">&#x27;crypto.randomBytes base64 statistical anomoly&#x27;</span>

    <span class="hljs-keyword">return</span> string.slice(<span class="hljs-number">0</span>,length)


<span class="hljs-built_in">module</span>.<span class="hljs-built_in">exports</span> = Helpers</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
